import{Da as R,Ea as l,Ia as w,Oa as u,e as o,g as d,h as n,ka as y,l as b,o as U,qa as g,r as a,ra as f,ta as A,ua as v,va as F}from"./chunk-JCN5TPWJ.js";var c=class{constructor(r,t,e,i,m,h){this.uid=r;this.email=t;this.username=e;this.photoURL=i;this.isAnonymous=m;this.chats=h}static privateUserModel(r){return{uid:r.uid,email:r.email,username:r.isAnonymous?`Guest#${r.uid.substring(0,4)}`:r.displayName,photoURL:r.photoURL,isAnonymous:r.isAnonymous?"Anonymous":"standard_user",chats:[{chatName:"general",chatId:"general"}]}}},p=class{constructor(r,t,e,i){this.uid=r;this.username=t;this.photoURL=e;this.isAnonymous=i}static publicUserModel(r){return{uid:r.uid,username:r.isAnonymous?`Guest#${r.uid.substring(0,4)}`:r.displayName,photoURL:r.photoURL||"",isAnonymous:r.isAnonymous?"Anonymous":"standard_user"}}};var I=class s{FireAuth=a(F);Fire=a(w);router=a(y);googleAuth(){return o(this,null,function*(){try{let r=new g;yield A(this.FireAuth,r),this.router.navigate(["/chats"]),this.storeUsers()}catch{}})}loginAsAnonym(){return o(this,null,function*(){let r=v();try{return yield f(r).then(e=>{this.storeUsers()})}catch(t){return t}})}logOut(){return o(this,null,function*(){this.FireAuth.signOut()})}storeUsers(){return o(this,null,function*(){let r=this.FireAuth.currentUser;if(!r)return;let t=c.privateUserModel(r),e=p.publicUserModel(r),i=u(this.Fire,`users/${r.uid}`),m=u(this.Fire,`publicUser/${r.uid}`);try{yield l(i,t,{merge:!0}),yield l(m,e,{merge:!0})}catch(h){console.error(h)}})}currentUser(){let r=this.FireAuth.currentUser;if(!r)return n(null);let t=u(this.Fire,`users/${r.uid}`);return d(R(t)).pipe(b(e=>{if(e.exists()){let i=e.data();return n(i)}else return n(null)}))}static \u0275fac=function(t){return new(t||s)};static \u0275prov=U({token:s,factory:s.\u0275fac,providedIn:"root"})};export{I as a};
