<main>
  @if (modalOpen()) {
  <div class="modal-component">
    <app-chat-create-modal
      (emitChatName)="createChat($event)"
      (closeModal)="modalOpen.set(!modalOpen())"
    />
  </div>
  } @if (notificationOpen()) {
  <app-notification-modal
    (closeModal)="notificationOpen.set(!notificationOpen())"
    (emitAccept)="acceptInvite($event)"
    (emitDecline)="declineInvite($event)"
    [data]="notifications()"
  />
  } @if (searchToggle()) {
  <app-user-search
    (close)="searchToggle.set(!searchToggle())"
    (emitSearch)="getUserSearch($event)"
    (emitInvite)="inviteUser($event)"
    [results]="foundUsers()"
  />
  }

  <section>
    <aside id="left-panel">
      <div class="top-section">
        <ul>
          <li>
            <a (click)="modalOpen.set(!modalOpen())">Create chat</a>
          </li>
        </ul>
      </div>
      <div class="chat-list">
        <!-- იუზერის ჩატების დასარენდერებლად -->
        @for (chat of combinedChats(); track $index) {

        <div
          class="chat-wrap"
          [ngClass]="{ active: currentChat() === chat.chatId }"
        >
          <app-mini-chat [chatData]="chat" (chatSelected)="setChat($event)" />
        </div>

        }
      </div>
      <div class="user-m-profile">
        <!-- იუზერის პატარა მინი პროფილი სადაც გამოჩდება მოწვევები-->
        <app-user-mini-profile
          [user]="currentUser()"
          [notificationCount]="notifications().length"
          (openNotification)="notificationOpen.set(!notificationOpen())"
        />
      </div>
    </aside>
    <aside id="chat-content">
      <div class="content" [appScroll]="chatContent() || currentChat() !== ''">
        <!-- მესიჯების დასარენდერებლად გამოიყენება -->

        @if (loadingChat()) {
        <h1>Loading...</h1>
        }@else if (currentChat() === '') {

        <div class="n-chat">
          <p>💬 No messages yet — start the conversation and say hello! 👋</p>
        </div>

        }@else {

        <div class="chat-content-wrap">
          @if (chatContent().length === 0) {

          <div class="n-chat">
            <p>💬 No messages sent yet — say hello to members! 👋</p>
          </div>

          } @else { @for (messageData of chatContent(); track $index) {
          <app-chat-content
            [chatContent]="messageData"
            [ngClass]="
              messageData.user_id === currentUser()?.uid ? 'myMsg' : ''
            "
          />
          } }
        </div>
        }
      </div>

      @if (currentChat() !== '') {
      <div class="input-area">
        <form [formGroup]="messageControl" (ngSubmit)="sendMessage()">
          <input
            type="text"
            placeholder="Type your message here..."
            formControlName="message"
          />
          <button type="submit">Send</button>

          <button
            type="submit"
            *ngIf="currentChat() !== 'general'"
            (click)="searchToggle.set(!searchToggle())"
          >
            Invite people
          </button>
        </form>
      </div>
      }
    </aside>
  </section>
</main>
